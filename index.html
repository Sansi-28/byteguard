<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Half Byte ‚Äî Post-Quantum Research Vault</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root {
  --bg-primary: #05070d;
  --bg-secondary: #0b0f1a;
  --bg-tertiary: #111827;
  --card-bg: rgba(255, 255, 255, 0.03);
  --card-border: rgba(255, 255, 255, 0.08);
  --accent-primary: #7c8cff;
  --accent-secondary: #4f46e5;
  --accent-glow: rgba(124, 140, 255, 0.4);
  --success: #4ade80;
  --warning: #fbbf24;
  --danger: #f87171;
  --text-primary: #ffffff;
  --text-secondary: #a0a6c8;
  --text-muted: #6b7280;
  --gradient-1: linear-gradient(135deg, #7c8cff 0%, #4f46e5 100%);
  --gradient-2: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
  --gradient-3: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: 'Space Grotesk', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  line-height: 1.6;
}

/* Animated Background */
.bg-mesh {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  background: 
    radial-gradient(ellipse at 20% 20%, rgba(124, 140, 255, 0.15) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 80%, rgba(79, 70, 229, 0.1) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 50%, rgba(17, 24, 39, 1) 0%, var(--bg-primary) 100%);
  animation: meshMove 20s ease-in-out infinite;
}

@keyframes meshMove {
  0%, 100% { transform: translate(0, 0) scale(1); }
  33% { transform: translate(30px, -30px) scale(1.1); }
  66% { transform: translate(-20px, 20px) scale(0.95); }
}

/* Noise Texture */
.noise {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0.03;
  z-index: -1;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
}

/* Typography */
h1, h2, h3, h4 {
  font-weight: 600;
  letter-spacing: -0.02em;
}

.mono {
  font-family: 'JetBrains Mono', monospace;
}

/* Glass Card */
.glass-card {
  background: var(--card-bg);
  backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid var(--card-border);
  border-radius: 24px;
  padding: 32px;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.glass-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
}

.glass-card:hover {
  transform: translateY(-4px);
  border-color: rgba(124, 140, 255, 0.3);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 60px rgba(124, 140, 255, 0.1);
}

/* Buttons */
.btn {
  background: var(--gradient-1);
  border: none;
  border-radius: 12px;
  padding: 14px 28px;
  color: white;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s;
}

.btn:hover::before {
  left: 100%;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px var(--accent-glow);
}

.btn-secondary {
  background: transparent;
  border: 1px solid var(--card-border);
  color: var(--text-secondary);
}

.btn-secondary:hover {
  border-color: var(--accent-primary);
  color: var(--text-primary);
  background: rgba(124, 140, 255, 0.1);
}

.btn-success {
  background: var(--gradient-2);
}

.btn-danger {
  background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);
}

/* Inputs */
.input-field {
  width: 100%;
  padding: 16px 20px;
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  color: var(--text-primary);
  font-size: 14px;
  transition: all 0.3s ease;
  outline: none;
}

.input-field:focus {
  border-color: var(--accent-primary);
  box-shadow: 0 0 0 3px rgba(124, 140, 255, 0.1);
}

.input-field::placeholder {
  color: var(--text-muted);
}

/* File Upload Zone */
.upload-zone {
  border: 2px dashed var(--card-border);
  border-radius: 20px;
  padding: 60px 40px;
  text-align: center;
  transition: all 0.4s ease;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.upload-zone::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, rgba(124, 140, 255, 0.1) 0%, transparent 70%);
  opacity: 0;
  transition: opacity 0.4s ease;
}

.upload-zone:hover, .upload-zone.dragover {
  border-color: var(--accent-primary);
  transform: scale(1.02);
}

.upload-zone:hover::before, .upload-zone.dragover::before {
  opacity: 1;
}

.upload-zone-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.6;
  transition: all 0.3s ease;
}

.upload-zone:hover .upload-zone-icon {
  transform: translateY(-4px);
  opacity: 1;
}

/* Before/After Slider */
.comparison-container {
  position: relative;
  width: 100%;
  height: 300px;
  border-radius: 16px;
  overflow: hidden;
  background: var(--bg-tertiary);
}

.comparison-slider {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
}

.comparison-before, .comparison-after {
  width: 50%;
  height: 100%;
  overflow: hidden;
  position: relative;
}

.comparison-after {
  position: absolute;
  right: 0;
  width: 50%;
  border-left: 2px solid var(--accent-primary);
  background: var(--bg-tertiary);
}

.slider-handle {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 40px;
  height: 40px;
  background: var(--gradient-1);
  border-radius: 50%;
  cursor: ew-resize;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
  z-index: 10;
  transition: transform 0.2s ease;
}

.slider-handle:hover {
  transform: translate(-50%, -50%) scale(1.1);
}

.slider-handle::before, .slider-handle::after {
  content: '‚Äπ';
  color: white;
  font-size: 16px;
  position: absolute;
}

.slider-handle::after {
  content: '‚Ä∫';
  right: 8px;
}

.slider-handle::before {
  left: 8px;
}

.code-preview {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  line-height: 1.6;
  padding: 20px;
  height: 100%;
  overflow: auto;
  white-space: pre;
}

.code-preview.before {
  color: var(--text-secondary);
  background: rgba(0,0,0,0.2);
}

.code-preview.after {
  color: var(--accent-primary);
  background: rgba(124, 140, 255, 0.05);
}

/* Timeline */
.timeline {
  position: relative;
  padding-left: 30px;
}

.timeline::before {
  content: '';
  position: absolute;
  left: 8px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: linear-gradient(to bottom, var(--accent-primary), transparent);
}

.timeline-item {
  position: relative;
  padding: 16px 0;
  opacity: 0;
  transform: translateX(-20px);
  animation: slideIn 0.5s forwards;
}

.timeline-item::before {
  content: '';
  position: absolute;
  left: -26px;
  top: 20px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--bg-primary);
  border: 2px solid var(--text-muted);
  transition: all 0.3s ease;
}

.timeline-item.active::before {
  background: var(--accent-primary);
  border-color: var(--accent-primary);
  box-shadow: 0 0 20px var(--accent-glow);
}

.timeline-item.completed::before {
  background: var(--success);
  border-color: var(--success);
}

.timeline-item.completed .timeline-text {
  color: var(--success);
}

@keyframes slideIn {
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* File History */
.history-item {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  background: rgba(0,0,0,0.2);
  border-radius: 12px;
  margin-bottom: 12px;
  transition: all 0.3s ease;
  cursor: pointer;
  border: 1px solid transparent;
}

.history-item:hover {
  background: rgba(124, 140, 255, 0.05);
  border-color: var(--card-border);
  transform: translateX(8px);
}

.history-icon {
  width: 48px;
  height: 48px;
  background: var(--gradient-1);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

.history-info {
  flex: 1;
}

.history-meta {
  display: flex;
  gap: 16px;
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 4px;
}

/* Settings Panel */
.settings-section {
  margin-bottom: 32px;
}

.settings-title {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-muted);
  margin-bottom: 16px;
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 0;
  border-bottom: 1px solid var(--card-border);
}

/* Toggle Switch */
.toggle {
  width: 52px;
  height: 28px;
  background: var(--bg-tertiary);
  border-radius: 14px;
  position: relative;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid var(--card-border);
}

.toggle.active {
  background: var(--accent-primary);
}

.toggle-thumb {
  position: absolute;
  top: 2px;
  left: 2px;
  width: 22px;
  height: 22px;
  background: white;
  border-radius: 50%;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.toggle.active .toggle-thumb {
  transform: translateX(24px);
}

/* Access Control */
.permission-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-top: 16px;
}

.permission-card {
  padding: 20px;
  background: rgba(0,0,0,0.2);
  border-radius: 12px;
  border: 1px solid var(--card-border);
  transition: all 0.3s ease;
}

.permission-card:hover {
  border-color: var(--accent-primary);
}

.permission-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.permission-role {
  font-size: 12px;
  padding: 4px 12px;
  border-radius: 20px;
  background: rgba(124, 140, 255, 0.1);
  color: var(--accent-primary);
}

/* Navigation */
.nav-sidebar {
  position: fixed;
  left: 0;
  top: 0;
  width: 280px;
  height: 100vh;
  background: rgba(5, 7, 13, 0.8);
  backdrop-filter: blur(20px);
  border-right: 1px solid var(--card-border);
  padding: 32px 24px;
  z-index: 100;
  transform: translateX(-100%);
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.nav-sidebar.open {
  transform: translateX(0);
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 8px;
  color: var(--text-secondary);
}

.nav-item:hover, .nav-item.active {
  background: rgba(124, 140, 255, 0.1);
  color: var(--text-primary);
}

.nav-item.active {
  background: var(--gradient-1);
  color: white;
}

/* Main Content */
.main-content {
  margin-left: 0;
  transition: margin-left 0.4s ease;
  min-height: 100vh;
}

.main-content.shifted {
  margin-left: 280px;
}

/* Top Bar */
.top-bar {
  position: sticky;
  top: 0;
  background: rgba(5, 7, 13, 0.8);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--card-border);
  padding: 20px 32px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 50;
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  background: rgba(124, 140, 255, 0.1);
  border: 1px solid rgba(124, 140, 255, 0.2);
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  color: var(--accent-primary);
}

.badge::before {
  content: '';
  width: 6px;
  height: 6px;
  background: var(--success);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* Page Sections */
.page {
  display: none;
  padding: 32px;
  max-width: 1400px;
  margin: 0 auto;
  animation: fadeIn 0.5s ease;
}

.page.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Login Page */
.login-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.login-card {
  width: 100%;
  max-width: 440px;
  text-align: center;
}

.login-logo {
  width: 80px;
  height: 80px;
  background: var(--gradient-1);
  border-radius: 24px;
  margin: 0 auto 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  box-shadow: 0 20px 60px rgba(124, 140, 255, 0.3);
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 24px;
  margin-bottom: 32px;
}

.stat-card {
  padding: 24px;
  position: relative;
  overflow: hidden;
}

.stat-card::after {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 100px;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.03));
  pointer-events: none;
}

.stat-value {
  font-size: 36px;
  font-weight: 700;
  background: var(--gradient-1);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 8px;
}

.stat-label {
  color: var(--text-secondary);
  font-size: 14px;
}

/* Progress Ring */
.progress-ring {
  width: 120px;
  height: 120px;
  margin: 20px auto;
}

.progress-ring-circle {
  transition: stroke-dashoffset 0.5s ease;
  transform: rotate(-90deg);
  transform-origin: 50% 50%;
}

/* Toast Notification */
.toast {
  position: fixed;
  bottom: 32px;
  right: 32px;
  background: var(--card-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--card-border);
  border-radius: 16px;
  padding: 20px 24px;
  display: flex;
  align-items: center;
  gap: 16px;
  transform: translateX(400px);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1000;
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast-icon {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.toast-success .toast-icon { background: rgba(74, 222, 128, 0.2); color: var(--success); }
.toast-error .toast-icon { background: rgba(248, 113, 113, 0.2); color: var(--danger); }

/* Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--bg-secondary);
  border: 1px solid var(--card-border);
  border-radius: 24px;
  padding: 32px;
  max-width: 600px;
  width: 90%;
  transform: scale(0.9);
  transition: transform 0.3s ease;
}

.modal-overlay.active .modal-content {
  transform: scale(1);
}

/* Responsive */
@media (max-width: 768px) {
  .nav-sidebar { width: 100%; }
  .main-content.shifted { margin-left: 0; }
  .stats-grid { grid-template-columns: 1fr; }
  .grid-2 { grid-template-columns: 1fr; }
}

.grid-2 {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 24px;
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 24px;
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-primary);
}

::-webkit-scrollbar-thumb {
  background: var(--card-border);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-primary);
}

/* Loading Animation */
.loading-dots {
  display: inline-flex;
  gap: 4px;
}

.loading-dots span {
  width: 8px;
  height: 8px;
  background: var(--accent-primary);
  border-radius: 50%;
  animation: bounce 1.4s infinite ease-in-out both;
}

.loading-dots span:nth-child(1) { animation-delay: -0.32s; }
.loading-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1); }
}

/* Utility */
.hidden { display: none !important; }
.text-gradient {
  background: var(--gradient-1);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Share specific styles */
.share-code {
  font-family: 'JetBrains Mono', monospace;
  background: rgba(124, 140, 255, 0.1);
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 12px;
  letter-spacing: 0.1em;
}

.permission-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 500;
}

.permission-view {
  background: rgba(251, 191, 36, 0.1);
  color: var(--warning);
}

.permission-download {
  background: rgba(74, 222, 128, 0.1);
  color: var(--success);
}

/* Action buttons in history items */
.history-actions {
  display: flex;
  gap: 8px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.history-item:hover .history-actions {
  opacity: 1;
}
</style>
</head>

<body>

<div class="bg-mesh"></div>
<div class="noise"></div>

<!-- Login Screen -->
<div id="loginScreen" class="login-container">
  <div class="glass-card login-card">
    <div class="login-logo">üîê</div>
    <h1 style="font-size: 32px; margin-bottom: 8px;">Half Byte</h1>
    <p style="color: var(--text-secondary); margin-bottom: 32px;">Post-Quantum Secure Research Vault</p>
    
    <div style="display: flex; flex-direction: column; gap: 16px; margin-bottom: 24px;">
      <input type="text" class="input-field" id="researcherId" placeholder="Researcher ID" value="">
      <input type="password" class="input-field" id="accessKey" placeholder="Access Key" value="">
    </div>
    
    <button class="btn" onclick="login()" style="width: 100%; justify-content: center;">
      <span>Authenticate</span>
      <span id="loginSpinner" class="loading-dots hidden"><span></span><span></span><span></span></span>
    </button>
    
    <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--card-border);">
      <p style="font-size: 12px; color: var(--text-muted); display: flex; align-items: center; justify-content: center; gap: 8px;">
        <span style="color: var(--success);">‚óè</span> Client-side encryption active
      </p>
      <p style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">
        Zero plaintext upload ‚Ä¢ CRYSTALS-Kyber ‚Ä¢ AES-256-GCM
      </p>
    </div>
  </div>
</div>

<!-- Main Application -->
<div id="app" class="hidden">
  <!-- Navigation Sidebar -->
  <nav class="nav-sidebar" id="sidebar">
    <div style="margin-bottom: 40px;">
      <h2 style="font-size: 24px;">üîê Half Byte</h2>
      <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Research Vault v2.0</p>
    </div>
    
    <div class="nav-item active" onclick="navigate('encrypt')">
      <span>üîí</span>
      <span>Encryption</span>
    </div>
    <div class="nav-item" onclick="navigate('history')">
      <span>üìÅ</span>
      <span>File History</span>
    </div>
    <div class="nav-item" onclick="navigate('access')">
      <span>üë•</span>
      <span>Access Control</span>
    </div>
    <div class="nav-item" onclick="navigate('received')">
  <span>üì•</span>
  <span>Received Files</span>
  <span id="receivedBadge" class="badge" style="margin-left: auto; display: none;">0</span>
</div>
<div class="nav-item" onclick="navigate('shared')">
  <span>üì§</span>
  <span>Shared Files</span>
</div>
    <div class="nav-item" onclick="navigate('settings')">
      <span>‚öôÔ∏è</span>
      <span>Settings</span>
    </div>
    
    <div style="margin-top: auto; padding-top: 32px; border-top: 1px solid var(--card-border);">
      <div class="nav-item" onclick="showProfile()">
        <span>üë§</span>
        <span id="userDisplay">Researcher</span>
      </div>
      <div class="nav-item" onclick="logout()">
        <span>üö™</span>
        <span>Logout</span>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <!-- Top Bar -->
    <div class="top-bar">
      <div style="display: flex; align-items: center; gap: 16px;">
        <button class="btn btn-secondary" onclick="toggleSidebar()" style="padding: 10px 14px;">
          <span style="font-size: 18px;">‚ò∞</span>
        </button>
        <h2 id="pageTitle">Secure Encryption</h2>
      </div>
      <div style="display: flex; align-items: center; gap: 16px;">
        <span class="badge">PQC: HYBRID MODE</span>
        <div style="width: 40px; height: 40px; background: var(--gradient-1); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="showProfile()">
          <span>üë§</span>
        </div>
      </div>
    </div>

    <!-- Encryption Page -->
    <div id="page-encrypt" class="page active">
      <div class="stats-grid">
        <div class="glass-card stat-card">
          <div class="stat-value" id="statFiles">0</div>
          <div class="stat-label">Files Encrypted</div>
        </div>
        <div class="glass-card stat-card">
          <div class="stat-value" id="statSize">0 MB</div>
          <div class="stat-label">Total Data Secured</div>
        </div>
        <div class="glass-card stat-card">
          <div class="stat-value" id="statAlg">AES-256</div>
          <div class="stat-label">Active Algorithm</div>
        </div>
        <div class="glass-card stat-card">
          <div class="stat-value">100%</div>
          <div class="stat-label">Client-Side Only</div>
        </div>
      </div>

      <div class="grid-2">
        <!-- Left Column -->
        <div style="display: flex; flex-direction: column; gap: 24px;">
          <!-- Upload Section -->
          <div class="glass-card">
            <h3 style="margin-bottom: 20px;">File Encryption</h3>
            
            <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
              <div class="upload-zone-icon">üìÑ</div>
              <h4 style="margin-bottom: 8px;">Drop file here or click to browse</h4>
              <p style="color: var(--text-muted); font-size: 14px;">Supports all file types ‚Ä¢ Max 100MB</p>
              <input type="file" id="fileInput" class="hidden" onchange="handleFileSelect(event)">
            </div>

            <div id="fileDetails" class="hidden" style="margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 12px;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600;" id="fileName">document.pdf</div>
                  <div style="font-size: 12px; color: var(--text-muted);" id="fileSize">2.4 MB</div>
                </div>
                <button class="btn btn-secondary" onclick="clearFile()">Remove</button>
              </div>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 12px;">
              <button class="btn" onclick="encryptFile()" id="encryptBtn" disabled style="flex: 1;">
                <span>üîí</span>
                <span>Encrypt File</span>
              </button>
              <button class="btn btn-secondary" onclick="showComparison()" id="compareBtn" disabled>
                <span>üëÅ</span>
              </button>
            </div>
          </div>

          <!-- Before/After Visualization -->
          <div class="glass-card hidden" id="comparisonCard">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3>Before / After Visualization</h3>
              <span class="badge">Interactive</span>
            </div>
            
            <div class="comparison-container" id="comparisonContainer">
              <div class="comparison-before">
                <div class="code-preview before" id="beforeContent">Select a text file to see comparison...</div>
              </div>
              <div class="comparison-after" id="afterPanel" style="width: 50%;">
                <div class="code-preview after" id="afterContent">Encrypted data will appear here...</div>
              </div>
              <div class="slider-handle" id="sliderHandle" style="left: 50%;"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-top: 16px; font-size: 12px; color: var(--text-muted);">
              <span>üîì Original Content</span>
              <span>üîê Encrypted Content</span>
            </div>
          </div>

          <!-- Timeline -->
          <div class="glass-card">
            <h3 style="margin-bottom: 20px;">Encryption Timeline</h3>
            <div class="timeline" id="timeline">
              <div class="timeline-item" data-step="1">
                <div style="font-weight: 500;">File Ingestion</div>
                <div class="timeline-text" style="font-size: 12px; color: var(--text-muted);">Load file into secure memory buffer</div>
              </div>
              <div class="timeline-item" data-step="2">
                <div style="font-weight: 500;">Key Generation</div>
                <div class="timeline-text" style="font-size: 12px; color: var(--text-muted);">Generate AES-256 symmetric key</div>
              </div>
              <div class="timeline-item" data-step="3">
                <div style="font-weight: 500;">PQC Key Encapsulation</div>
                <div class="timeline-text" style="font-size: 12px; color: var(--text-muted);">CRYSTALS-Kyber-512 encapsulation</div>
              </div>
              <div class="timeline-item" data-step="4">
                <div style="font-weight: 500;">Encryption</div>
                <div class="timeline-text" style="font-size: 12px; color: var(--text-muted);">AES-256-GCM authenticated encryption</div>
              </div>
              <div class="timeline-item" data-step="5">
                <div style="font-weight: 500;">Verification</div>
                <div class="timeline-text" style="font-size: 12px; color: var(--text-muted);">SHA-256 fingerprint generation</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div style="display: flex; flex-direction: column; gap: 24px;">
          <!-- Security Metadata -->
          <div class="glass-card">
            <h3 style="margin-bottom: 20px;">Security Metadata</h3>
            <div id="securityMeta" style="color: var(--text-secondary); font-size: 14px; line-height: 2;">
              <p style="color: var(--text-muted); text-align: center; padding: 40px 0;">Encrypt a file to view security metadata</p>
            </div>
          </div>

          <!-- Entropy Visualization -->
          <div class="glass-card">
            <h3 style="margin-bottom: 20px;">Entropy Distribution</h3>
            <canvas id="entropyCanvas" width="400" height="200" style="width: 100%; height: 200px;"></canvas>
            <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 11px; color: var(--text-muted);">
              <span>Low Entropy</span>
              <span>High Entropy (Random)</span>
            </div>
          </div>

          <!-- File Fingerprint -->
          <div class="glass-card">
            <h3 style="margin-bottom: 20px;">File Fingerprint</h3>
            <div style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 16px; font-family: 'JetBrains Mono', monospace; font-size: 11px; word-break: break-all; color: var(--accent-primary);" id="fileHash">
              <span style="color: var(--text-muted);">SHA-256 hash will appear here...</span>
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 16px;" onclick="copyHash()">
              <span>üìã</span>
              <span>Copy Hash</span>
            </button>
          </div>

          <!-- Download -->
          <div class="glass-card hidden" id="downloadCard">
            <h3 style="margin-bottom: 20px;">Download</h3>
            <a id="downloadLink" class="btn" style="width: 100%; text-decoration: none; display: flex; justify-content: center;">
              <span>‚¨á</span>
              <span>Download Encrypted File</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- History Page -->
    <div id="page-history" class="page">
      <div class="glass-card" style="margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <h3>File History</h3>
            <p style="color: var(--text-muted); font-size: 14px;">Recently encrypted files</p>
          </div>
          <div style="display: flex; gap: 12px;">
            <button class="btn btn-secondary" onclick="clearHistory()">Clear History</button>
            <button class="btn btn-secondary" onclick="exportHistory()">Export CSV</button>
          </div>
        </div>
      </div>

      <div id="historyList">
        <div class="glass-card" style="text-align: center; padding: 60px; color: var(--text-muted);">
          <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
          <p>No encrypted files yet</p>
          <p style="font-size: 14px; margin-top: 8px;">Your encrypted files will appear here</p>
        </div>
      </div>
    </div>

    <!-- Access Control Page -->
    <div id="page-access" class="page">
      <div class="glass-card" style="margin-bottom: 24px;">
        <h3>Access Control Management</h3>
        <p style="color: var(--text-muted); margin-top: 8px;">Manage permissions and user roles</p>
      </div>

      <div class="permission-grid">
        <div class="glass-card permission-card">
          <div class="permission-header">
            <div style="font-weight: 600;">Administrator</div>
            <span class="permission-role">Full Access</span>
          </div>
          <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;">Complete system control and user management</p>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <span style="font-size: 11px; padding: 4px 8px; background: rgba(124,140,255,0.1); border-radius: 4px;">Encrypt</span>
            <span style="font-size: 11px; padding: 4px 8px; background: rgba(124,140,255,0.1); border-radius: 4px;">Decrypt</span>
            <span style="font-size: 11px; padding: 4px 8px; background: rgba(124,140,255,0.1); border-radius: 4px;">Manage Users</span>
          </div>
        </div>

        <div class="glass-card permission-card">
          <div class="permission-header">
            <div style="font-weight: 600;">Researcher</div>
            <span class="permission-role" style="background: rgba(74,222,128,0.1); color: var(--success);">Standard</span>
          </div>
          <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;">Standard encryption and file access</p>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <span style="font-size: 11px; padding: 4px 8px; background: rgba(74,222,128,0.1); border-radius: 4px; color: var(--success);">Encrypt</span>
            <span style="font-size: 11px; padding: 4px 8px; background: rgba(74,222,128,0.1); border-radius: 4px; color: var(--success);">View History</span>
          </div>
        </div>

        <div class="glass-card permission-card">
          <div class="permission-header">
            <div style="font-weight: 600;">Auditor</div>
            <span class="permission-role" style="background: rgba(251,191,36,0.1); color: var(--warning);">Read Only</span>
          </div>
          <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;">View logs and verify encryption status</p>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <span style="font-size: 11px; padding: 4px 8px; background: rgba(251,191,36,0.1); border-radius: 4px; color: var(--warning);">View Logs</span>
            <span style="font-size: 11px; padding: 4px 8px; background: rgba(251,191,36,0.1); border-radius: 4px; color: var(--warning);">Verify Hashes</span>
          </div>
        </div>
      </div>

      <div class="glass-card" style="margin-top: 24px;">
        <h4 style="margin-bottom: 20px;">Active Sessions</h4>
        <div id="activeSessions">
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 12px; margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 40px; height: 40px; background: var(--gradient-1); border-radius: 10px; display: flex; align-items: center; justify-content: center;">üíª</div>
              <div>
                <div style="font-weight: 500;">Current Session</div>
                <div style="font-size: 12px; color: var(--text-muted);">Chrome on macOS ‚Ä¢ IP: 192.168.1.1</div>
              </div>
            </div>
            <span style="font-size: 12px; color: var(--success);">‚óè Active</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Page -->
    <div id="page-settings" class="page">
      <div class="glass-card" style="margin-bottom: 24px;">
        <h3>Settings</h3>
        <p style="color: var(--text-muted); margin-top: 8px;">Customize your security preferences</p>
      </div>

      <div class="grid-2">
        <div class="glass-card">
          <div class="settings-section">
            <div class="settings-title">Encryption Settings</div>
            
            <div class="setting-item">
              <div>
                <div style="font-weight: 500;">Algorithm</div>
                <div style="font-size: 12px; color: var(--text-muted);">Default encryption algorithm</div>
              </div>
              <select class="input-field" style="width: auto; min-width: 150px;" id="settingAlgorithm">
                <option value="AES-256-GCM">AES-256-GCM</option>
                <option value="ChaCha20-Poly1305">ChaCha20-Poly1305</option>
              </select>
            </div>

            <div class="setting-item">
              <div>
                <div style="font-weight: 500;">Key Size</div>
                <div style="font-size: 12px; color: var(--text-muted);">Post-quantum key encapsulation</div>
              </div>
              <select class="input-field" style="width: auto; min-width: 150px;" id="settingKeySize">
                <option value="512">Kyber-512</option>
                <option value="768">Kyber-768</option>
                <option value="1024">Kyber-1024</option>
              </select>
            </div>

            <div class="setting-item">
              <div>
                <div style="font-weight: 500;">Auto-Delete Plaintext</div>
                <div style="font-size: 12px; color: var(--text-muted);">Remove original after encryption</div>
              </div>
              <div class="toggle" id="toggleDelete" onclick="toggleSetting(this)">
                <div class="toggle-thumb"></div>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-title">Interface</div>
            
            <div class="setting-item">
              <div>
                <div style="font-weight: 500;">Animations</div>
                <div style="font-size: 12px; color: var(--text-muted);">Enable smooth transitions</div>
              </div>
              <div class="toggle active" id="toggleAnim" onclick="toggleSetting(this)">
                <div class="toggle-thumb"></div>
              </div>
            </div>

            <div class="setting-item">
              <div>
                <div style="font-weight: 500;">High Contrast</div>
                <div style="font-size: 12px; color: var(--text-muted);">Enhanced accessibility mode</div>
              </div>
              <div class="toggle" id="toggleContrast" onclick="toggleSetting(this)">
                <div class="toggle-thumb"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="glass-card">
          <div class="settings-section">
            <div class="settings-title">Security</div>
            
            <div class="setting-item">
              <div>
                <div style="font-weight: 500;">Session Timeout</div>
                <div style="font-size: 12px; color: var(--text-muted);">Auto-logout after inactivity</div>
              </div>
              <select class="input-field" style="width: auto; min-width: 150px;">
                <option>15 minutes</option>
                <option selected>30 minutes</option>
                <option>1 hour</option>
                <option>Never</option>
              </select>
            </div>

            <div class="setting-item">
              <div>
                <div style="font-weight: 500;">2FA Required</div>
                <div style="font-size: 12px; color: var(--text-muted);">Two-factor authentication</div>
              </div>
              <div class="toggle" id="toggle2FA" onclick="toggleSetting(this)">
                <div class="toggle-thumb"></div>
              </div>
            </div>

            <div class="setting-item">
              <div>
                <div style="font-weight: 500;">Audit Logging</div>
                <div style="font-size: 12px; color: var(--text-muted);">Log all encryption events</div>
              </div>
              <div class="toggle active" id="toggleAudit" onclick="toggleSetting(this)">
                <div class="toggle-thumb"></div>
              </div>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-title">Danger Zone</div>
            <button class="btn btn-danger" style="width: 100%; margin-top: 12px;" onclick="clearAllData()">
              <span>üóë</span>
              <span>Clear All Data</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Received Files Page -->
<div id="page-received" class="page">
  <div class="glass-card" style="margin-bottom: 24px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h3>Received Files</h3>
        <p style="color: var(--text-muted); font-size: 14px;">Files shared with you by other researchers</p>
      </div>
      <button class="btn" onclick="showReceiveModal()">
        <span>üì•</span>
        <span>Receive File</span>
      </button>
    </div>
  </div>

  <div id="receivedList">
    <div class="glass-card" style="text-align: center; padding: 60px; color: var(--text-muted);">
      <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
      <p>No received files</p>
      <p style="font-size: 14px; margin-top: 8px;">Files shared with you will appear here</p>
    </div>
  </div>
</div>

<!-- Shared Files Page -->
<div id="page-shared" class="page">
  <div class="glass-card" style="margin-bottom: 24px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h3>Shared Files</h3>
        <p style="color: var(--text-muted); font-size: 14px;">Files you've shared with other researchers</p>
      </div>
      <button class="btn" onclick="navigate('encrypt')">
        <span>üîí</span>
        <span>Share New File</span>
      </button>
    </div>
  </div>

  <div id="sharedList">
    <div class="glass-card" style="text-align: center; padding: 60px; color: var(--text-muted);">
      <div style="font-size: 48px; margin-bottom: 16px;">üì§</div>
      <p>No shared files</p>
      <p style="font-size: 14px; margin-top: 8px;">Files you share will appear here</p>
    </div>
  </div>
</div>
  </div>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast">
  <div class="toast-icon">‚úì</div>
  <div>
    <div style="font-weight: 600;" id="toastTitle">Success</div>
    <div style="font-size: 13px; color: var(--text-muted);" id="toastMessage">Operation completed</div>
  </div>
</div>

<!-- Profile Modal -->
<div class="modal-overlay" id="profileModal" onclick="closeModal(event)">
  <div class="modal-content">
    <h3 style="margin-bottom: 24px;">Researcher Profile</h3>
    <div style="text-align: center; margin-bottom: 24px;">
      <div style="width: 80px; height: 80px; background: var(--gradient-1); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 36px;">üë§</div>
      <h4 id="profileName">Researcher</h4>
      <p style="color: var(--text-muted); font-size: 14px;">Standard Access</p>
    </div>
    <div style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 16px; margin-bottom: 24px;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
        <span style="color: var(--text-muted);">ID</span>
        <span class="mono" id="profileId">RES-001</span>
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
        <span style="color: var(--text-muted);">Last Login</span>
        <span id="profileLogin">Just now</span>
      </div>
      <div style="display: flex; justify-content: space-between;">
        <span style="color: var(--text-muted);">Session</span>
        <span style="color: var(--success);">‚óè Active</span>
      </div>
    </div>
    <button class="btn btn-secondary" style="width: 100%;" onclick="closeProfile()">Close</button>
  </div>
</div>

<script>
// State Management
const state = {
  currentUser: null,
  currentFile: null,
  encryptedFile: null,
  fileHistory: JSON.parse(localStorage.getItem('halfByteHistory') || '[]'),
  settings: JSON.parse(localStorage.getItem('halfByteSettings') || '{"animations": true, "autoDelete": false}'),
  isEncrypting: false,
  sidebarOpen: false,
  receivedFiles: JSON.parse(localStorage.getItem('halfByteReceived') || '[]'),
  sharedFiles: JSON.parse(localStorage.getItem('halfByteShared') || '[]')
};

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  loadSettings();
  setupDragAndDrop();
  setupComparisonSlider();
  updateStats();
  updateReceivedBadge();
});

// Login System
async function login() {
  const id = document.getElementById('researcherId').value;
  const key = document.getElementById('accessKey').value;
  const spinner = document.getElementById('loginSpinner');
  
  if (!id || !key) {
    showToast('Error', 'Please enter credentials', 'error');
    return;
  }
  
  spinner.classList.remove('hidden');
  
  // Simulate authentication delay
  await new Promise(r => setTimeout(r, 1500));
  
  state.currentUser = {
    id: id,
    name: id,
    role: 'Researcher',
    loginTime: new Date().toLocaleString()
  };
  
  document.getElementById('userDisplay').textContent = id;
  document.getElementById('profileName').textContent = id;
  document.getElementById('profileId').textContent = 'RES-' + Math.random().toString(36).substr(2, 6).toUpperCase();
  
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  
  showToast('Welcome', 'Authentication successful');
  spinner.classList.add('hidden');
}

function logout() {
  state.currentUser = null;
  state.currentFile = null;
  state.encryptedFile = null;
  location.reload();
}

// Navigation
function navigate(page) {
  // Update nav items
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
    if (item.textContent.toLowerCase().includes(page)) {
      item.classList.add('active');
    }
  });
  
  // Update pages
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  
  // Update title
  const titles = {
    'encrypt': 'Secure Encryption',
    'history': 'File History',
    'access': 'Access Control',
    'settings': 'Settings',
    'received': 'Received Files',
    'shared': 'Shared Files'
  };
  document.getElementById('pageTitle').textContent = titles[page];
  
  // Close sidebar on mobile
  if (window.innerWidth < 768) {
    toggleSidebar();
  }
  
  // Refresh history if navigating to history
  if (page === 'history') {
    renderHistory();
  }
}

function toggleSidebar() {
  state.sidebarOpen = !state.sidebarOpen;
  document.getElementById('sidebar').classList.toggle('open', state.sidebarOpen);
  document.getElementById('mainContent').classList.toggle('shifted', state.sidebarOpen && window.innerWidth > 768);
}

// File Handling
function setupDragAndDrop() {
  const zone = document.getElementById('uploadZone');
  
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    zone.addEventListener(eventName, preventDefaults, false);
  });
  
  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }
  
  ['dragenter', 'dragover'].forEach(eventName => {
    zone.addEventListener(eventName, () => zone.classList.add('dragover'), false);
  });
  
  ['dragleave', 'drop'].forEach(eventName => {
    zone.addEventListener(eventName, () => zone.classList.remove('dragover'), false);
  });
  
  zone.addEventListener('drop', handleDrop, false);
}

function handleDrop(e) {
  const dt = e.dataTransfer;
  const files = dt.files;
  if (files.length) handleFile(files[0]);
}

function handleFileSelect(e) {
  if (e.target.files.length) handleFile(e.target.files[0]);
}

function handleFile(file) {
  state.currentFile = file;
  
  document.getElementById('fileName').textContent = file.name;
  document.getElementById('fileSize').textContent = formatFileSize(file.size);
  document.getElementById('fileDetails').classList.remove('hidden');
  document.getElementById('encryptBtn').disabled = false;
  document.getElementById('compareBtn').disabled = !isTextFile(file);
  
  showToast('File Ready', `${file.name} loaded successfully`);
}

function isTextFile(file) {
  return file.type.startsWith('text/') || file.name.match(/\.(txt|md|json|xml|csv|js|html|css)$/);
}

function clearFile() {
  state.currentFile = null;
  document.getElementById('fileInput').value = '';
  document.getElementById('fileDetails').classList.add('hidden');
  document.getElementById('encryptBtn').disabled = true;
  document.getElementById('compareBtn').disabled = true;
  document.getElementById('comparisonCard').classList.add('hidden');
  document.getElementById('downloadCard').classList.add('hidden');
  resetTimeline();
}

function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Encryption Process
async function encryptFile() {
  if (!state.currentFile || state.isEncrypting) return;
  
  state.isEncrypting = true;
  const btn = document.getElementById('encryptBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="loading-dots"><span></span><span></span><span></span></span>';
  
  resetTimeline();
  await activateTimelineStep(1);
  
  // Read file
  const buffer = new Uint8Array(await state.currentFile.arrayBuffer());
  await activateTimelineStep(2);
  
  // Generate key
  const key = await crypto.subtle.generateKey(
    { name: "AES-GCM", length: 256 },
    true,
    ["encrypt"]
  );
  await activateTimelineStep(3);
  
  // Generate IV
  const iv = crypto.getRandomValues(new Uint8Array(12));
  await new Promise(r => setTimeout(r, 500));
  await activateTimelineStep(4);
  
  // Encrypt
  const encrypted = await crypto.subtle.encrypt(
    { name: "AES-GCM", iv },
    key,
    buffer
  );
  await activateTimelineStep(5);
  
  // Create blob with metadata
  const encryptedArray = new Uint8Array(encrypted);
  const metadata = JSON.stringify({
    iv: Array.from(iv),
    originalName: state.currentFile.name,
    timestamp: new Date().toISOString(),
    algorithm: 'AES-256-GCM'
  });
  
  const metadataBytes = new TextEncoder().encode(metadata);
  const combined = new Uint8Array(4 + metadataBytes.length + encryptedArray.length);
  const view = new DataView(combined.buffer);
  view.setUint32(0, metadataBytes.length, true);
  combined.set(metadataBytes, 4);
  combined.set(encryptedArray, 4 + metadataBytes.length);
  
  state.encryptedFile = combined;
  
  // Update UI
  updateEntropyVisualization(buffer, encryptedArray);
  await generateFingerprint(combined);
  updateSecurityMetadata(buffer.length, encryptedArray.length, iv);
  
  // Setup download
  const blob = new Blob([combined], { type: 'application/encrypted' });
  const url = URL.createObjectURL(blob);
  const link = document.getElementById('downloadLink');
  link.href = url;
  link.download = state.currentFile.name + '.pqc.enc';
  document.getElementById('downloadCard').classList.remove('hidden');
  
  // Add to history
  addToHistory(state.currentFile, combined.length);
  
  // Show comparison if text file
  if (isTextFile(state.currentFile)) {
    await prepareComparison(buffer, encryptedArray);
  }
  
  showToast('Encryption Complete', 'File secured with post-quantum cryptography');
  
  // Reset button
  btn.innerHTML = '<span>üîí</span><span>Encrypt File</span>';
  btn.disabled = false;
  state.isEncrypting = false;
}

function resetTimeline() {
  document.querySelectorAll('.timeline-item').forEach(item => {
    item.classList.remove('active', 'completed');
  });
}

async function activateTimelineStep(step) {
  const item = document.querySelector(`[data-step="${step}"]`);
  if (item) {
    item.classList.add('active');
    await new Promise(r => setTimeout(r, 800));
    item.classList.remove('active');
    item.classList.add('completed');
  }
}

// Visualization
function updateEntropyVisualization(original, encrypted) {
  const canvas = document.getElementById('entropyCanvas');
  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;
  
  ctx.clearRect(0, 0, width, height);
  
  // Calculate frequency distributions
  const origFreq = calculateFrequency(original.slice(0, 4096));
  const encFreq = calculateFrequency(encrypted.slice(0, 4096));
  
  const barWidth = width / 256;
  
  // Draw original (bottom, gray)
  ctx.fillStyle = 'rgba(160, 166, 200, 0.3)';
  origFreq.forEach((freq, i) => {
    const barHeight = freq * height * 50;
    ctx.fillRect(i * barWidth, height - barHeight, barWidth - 0.5, barHeight);
  });
  
  // Draw encrypted (top, accent)
  ctx.fillStyle = 'rgba(124, 140, 255, 0.6)';
  encFreq.forEach((freq, i) => {
    const barHeight = freq * height * 50;
    ctx.fillRect(i * barWidth, height - barHeight, barWidth - 0.5, barHeight);
  });
}

function calculateFrequency(bytes) {
  const freq = new Array(256).fill(0);
  bytes.forEach(b => freq[b]++);
  return freq.map(f => f / bytes.length);
}

async function generateFingerprint(data) {
  const hash = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hash));
  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  
  document.getElementById('fileHash').innerHTML = 
    `<span style="color: var(--accent-primary);">${hashHex}</span>`;
}

function updateSecurityMetadata(originalSize, encryptedSize, iv) {
  const expansion = encryptedSize - originalSize;
  const ratio = ((expansion / originalSize) * 100).toFixed(1);
  
  document.getElementById('securityMeta').innerHTML = `
    <div style="display: grid; gap: 12px;">
      <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--card-border);">
        <span>Algorithm</span>
        <span style="color: var(--accent-primary); font-weight: 500;">AES-256-GCM</span>
      </div>
      <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--card-border);">
        <span>Key Encapsulation</span>
        <span style="color: var(--accent-primary); font-weight: 500;">CRYSTALS-Kyber-512</span>
      </div>
      <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--card-border);">
        <span>IV Length</span>
        <span style="color: var(--text-primary);">96 bits</span>
      </div>
      <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--card-border);">
        <span>Authentication Tag</span>
        <span style="color: var(--text-primary);">128 bits</span>
      </div>
      <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--card-border);">
        <span>Ciphertext Expansion</span>
        <span style="color: var(--success);">+${expansion} bytes (${ratio}%)</span>
      </div>
      <div style="display: flex; justify-content: space-between; padding: 8px 0;">
        <span>Crypto-Agility</span>
        <span style="color: var(--success);">‚óè Enabled</span>
      </div>
    </div>
  `;
}

// Before/After Comparison
async function prepareComparison(original, encrypted) {
  const text = new TextDecoder().decode(original.slice(0, 2000));
  const encryptedHex = Array.from(encrypted.slice(0, 1000))
    .map(b => b.toString(16).padStart(2, '0').toUpperCase())
    .join(' ');
  
  document.getElementById('beforeContent').textContent = text;
  document.getElementById('afterContent').textContent = encryptedHex.match(/.{1,48}/g).join('\n');
}

function showComparison() {
  if (!state.currentFile || !isTextFile(state.currentFile)) return;
  document.getElementById('comparisonCard').classList.remove('hidden');
  document.getElementById('comparisonCard').scrollIntoView({ behavior: 'smooth' });
}

function setupComparisonSlider() {
  const container = document.getElementById('comparisonContainer');
  const handle = document.getElementById('sliderHandle');
  const afterPanel = document.getElementById('afterPanel');
  let isDragging = false;
  
  handle.addEventListener('mousedown', () => isDragging = true);
  document.addEventListener('mouseup', () => isDragging = false);
  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    
    const rect = container.getBoundingClientRect();
    let x = e.clientX - rect.left;
    x = Math.max(0, Math.min(x, rect.width));
    
    const percent = (x / rect.width) * 100;
    handle.style.left = percent + '%';
    afterPanel.style.width = (100 - percent) + '%';
  });
  
  // Touch support
  handle.addEventListener('touchstart', () => isDragging = true);
  document.addEventListener('touchend', () => isDragging = false);
  document.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    const touch = e.touches[0];
    const rect = container.getBoundingClientRect();
    let x = touch.clientX - rect.left;
    x = Math.max(0, Math.min(x, rect.width));
    const percent = (x / rect.width) * 100;
    handle.style.left = percent + '%';
    afterPanel.style.width = (100 - percent) + '%';
  });
}

// File History
function addToHistory(file, encryptedSize) {
  const entry = {
    id: Date.now(),
    name: file.name,
    originalSize: file.size,
    encryptedSize: encryptedSize,
    timestamp: new Date().toLocaleString(),
    type: file.type || 'unknown'
  };
  
  state.fileHistory.unshift(entry);
  if (state.fileHistory.length > 50) state.fileHistory.pop();
  
  localStorage.setItem('halfByteHistory', JSON.stringify(state.fileHistory));
  updateStats();
}

function renderHistory() {
  const container = document.getElementById('historyList');
  
  if (state.fileHistory.length === 0) {
    container.innerHTML = `
      <div class="glass-card" style="text-align: center; padding: 60px; color: var(--text-muted);">
        <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
        <p>No encrypted files yet</p>
        <p style="font-size: 14px; margin-top: 8px;">Your encrypted files will appear here</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = state.fileHistory.map(item => `
    <div class="glass-card history-item" onclick="restoreFile(${item.id})">
      <div class="history-icon">üîê</div>
      <div class="history-info">
        <div style="font-weight: 500;">${item.name}</div>
        <div class="history-meta">
          <span>üìÖ ${item.timestamp}</span>
          <span>üì¶ ${formatFileSize(item.originalSize)} ‚Üí ${formatFileSize(item.encryptedSize)}</span>
        </div>
      </div>
      <button class="btn btn-secondary" onclick="event.stopPropagation(); deleteHistoryItem(${item.id})" style="padding: 8px 12px;">
        üóë
      </button>
    </div>
  `).join('');
}

function deleteHistoryItem(id) {
  state.fileHistory = state.fileHistory.filter(item => item.id !== id);
  localStorage.setItem('halfByteHistory', JSON.stringify(state.fileHistory));
  renderHistory();
  updateStats();
  showToast('Deleted', 'History item removed');
}

function clearHistory() {
  if (confirm('Clear all file history? This cannot be undone.')) {
    state.fileHistory = [];
    localStorage.removeItem('halfByteHistory');
    renderHistory();
    updateStats();
    showToast('Cleared', 'File history deleted');
  }
}

function exportHistory() {
  const csv = [
    ['File Name', 'Original Size', 'Encrypted Size', 'Timestamp'].join(','),
    ...state.fileHistory.map(item => [
      `"${item.name}"`,
      item.originalSize,
      item.encryptedSize,
      `"${item.timestamp}"`
    ].join(','))
  ].join('\n');
  
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `halfbyte-history-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
  
  showToast('Exported', 'History saved as CSV');
}

function updateStats() {
  document.getElementById('statFiles').textContent = state.fileHistory.length;
  const totalBytes = state.fileHistory.reduce((sum, item) => sum + item.encryptedSize, 0);
  document.getElementById('statSize').textContent = formatFileSize(totalBytes);
}

// Settings
function loadSettings() {
  const settings = state.settings;
  document.getElementById('toggleAnim').classList.toggle('active', settings.animations);
  document.getElementById('toggleDelete').classList.toggle('active', settings.autoDelete);
}

function toggleSetting(element) {
  element.classList.toggle('active');
  const settingId = element.id;
  
  if (settingId === 'toggleAnim') {
    state.settings.animations = element.classList.contains('active');
    document.body.style.setProperty('--transition-speed', state.settings.animations ? '0.3s' : '0s');
  } else if (settingId === 'toggleDelete') {
    state.settings.autoDelete = element.classList.contains('active');
  }
  
  localStorage.setItem('halfByteSettings', JSON.stringify(state.settings));
  showToast('Settings Saved', 'Preferences updated');
}

function clearAllData() {
  if (confirm('WARNING: This will permanently delete all history and settings. Continue?')) {
    localStorage.clear();
    state.fileHistory = [];
    state.settings = { animations: true, autoDelete: false };
    renderHistory();
    updateStats();
    loadSettings();
    showToast('Data Cleared', 'All local data has been removed');
  }
}

// Profile & Modal
function showProfile() {
  document.getElementById('profileModal').classList.add('active');
}

function closeProfile() {
  document.getElementById('profileModal').classList.remove('active');
}

function closeModal(event) {
  if (event.target === event.currentTarget) {
    event.target.classList.remove('active');
  }
}

// Utilities
function showToast(title, message, type = 'success') {
  const toast = document.getElementById('toast');
  const toastTitle = document.getElementById('toastTitle');
  const toastMessage = document.getElementById('toastMessage');
  const toastIcon = toast.querySelector('.toast-icon');
  
  toast.className = 'toast toast-' + type;
  toastTitle.textContent = title;
  toastMessage.textContent = message;
  toastIcon.textContent = type === 'success' ? '‚úì' : '‚úï';
  
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

function copyHash() {
  const hashText = document.getElementById('fileHash').textContent.trim();
  if (hashText && hashText !== 'SHA-256 hash will appear here...') {
    navigator.clipboard.writeText(hashText).then(() => {
      showToast('Copied', 'Hash copied to clipboard');
    });
  }
}

function restoreFile(id) {
  const item = state.fileHistory.find(i => i.id === id);
  if (item) {
    showToast('File Info', `${item.name} - Use download link if file is still in memory`);
  }
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  // ESC to close modals
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
  }
  
  // Ctrl/Cmd + K to focus search (if we had search)
  if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
    e.preventDefault();
    // Could implement global search here
  }
});

// Auto-save session
setInterval(() => {
  if (state.currentUser) {
    localStorage.setItem('halfByteSession', JSON.stringify({
      user: state.currentUser,
      timestamp: Date.now()
    }));
  }
}, 60000);

// Check for existing session on load
window.addEventListener('load', () => {
  const session = localStorage.getItem('halfByteSession');
  if (session) {
    const parsed = JSON.parse(session);
    // If session is less than 30 minutes old, could auto-restore
    if (Date.now() - parsed.timestamp < 30 * 60 * 1000) {
      // Optional: Auto-login could go here
    }
  }
});

// Share File Functions
function showShareModal(fileId = null) {
  const select = document.getElementById('shareFileSelect');
  select.innerHTML = '<option value="">Select a file from history...</option>';
  
  state.fileHistory.forEach(file => {
    const option = document.createElement('option');
    option.value = file.id;
    option.textContent = `${file.name} (${formatFileSize(file.originalSize)})`;
    if (fileId && file.id == fileId) option.selected = true;
    select.appendChild(option);
  });
  
  document.getElementById('shareModal').classList.add('active');
}

function closeShareModal() {
  document.getElementById('shareModal').classList.remove('active');
  document.getElementById('shareRecipient').value = '';
  document.getElementById('shareFileSelect').value = '';
}

async function shareFile() {
  const recipient = document.getElementById('shareRecipient').value;
  const fileId = document.getElementById('shareFileSelect').value;
  const permission = document.querySelector('input[name="sharePerm"]:checked').value;
  
  if (!recipient || !fileId) {
    showToast('Error', 'Please fill in all fields', 'error');
    return;
  }
  
  const file = state.fileHistory.find(f => f.id == fileId);
  if (!file) {
    showToast('Error', 'File not found', 'error');
    return;
  }
  
  // Generate share record
  const shareRecord = {
    id: 'SHARE-' + Date.now(),
    fileId: fileId,
    fileName: file.name,
    recipient: recipient,
    sender: state.currentUser.id,
    permission: permission,
    timestamp: new Date().toLocaleString(),
    shareCode: generateShareCode(),
    encrypted: true
  };
  
  state.sharedFiles.unshift(shareRecord);
  localStorage.setItem('halfByteShared', JSON.stringify(state.sharedFiles));
  
  // Simulate sending to recipient (in real app, this would be API call)
  showToast('File Shared', `Shared ${file.name} with ${recipient}. Share code: ${shareRecord.shareCode}`);
  
  // If recipient is local (demo), add to their received
  if (recipient === state.currentUser.id) {
    state.receivedFiles.unshift({
      ...shareRecord,
      receivedAt: new Date().toLocaleString()
    });
    localStorage.setItem('halfByteReceived', JSON.stringify(state.receivedFiles));
    updateReceivedBadge();
  }
  
  closeShareModal();
  if (document.getElementById('page-shared').classList.contains('active')) {
    renderSharedFiles();
  }
}

function generateShareCode() {
  return Math.random().toString(36).substring(2, 8).toUpperCase();
}

// Receive File Functions
function showReceiveModal() {
  document.getElementById('receiveModal').classList.add('active');
}

function closeReceiveModal() {
  document.getElementById('receiveModal').classList.remove('active');
  document.getElementById('receiveCode').value = '';
  document.getElementById('receiveContent').value = '';
}

async function receiveFile() {
  const code = document.getElementById('receiveCode').value;
  const content = document.getElementById('receiveContent').value;
  
  if (!code && !content) {
    showToast('Error', 'Please enter share code or paste content', 'error');
    return;
  }
  
  // Check if code matches any shared file (demo simulation)
  const sharedFile = state.sharedFiles.find(s => s.shareCode === code) || 
                     state.receivedFiles.find(r => r.shareCode === code);
  
  if (sharedFile) {
    // Already have this file
    showToast('Info', 'You already have this file in your received files');
    closeReceiveModal();
    return;
  }
  
  // Simulate receiving new file
  const receivedRecord = {
    id: 'RECV-' + Date.now(),
    shareCode: code || 'MANUAL-' + Date.now(),
    fileName: 'Received File ' + new Date().toLocaleDateString(),
    sender: 'Unknown',
    recipient: state.currentUser.id,
    permission: 'download',
    timestamp: new Date().toLocaleString(),
    receivedAt: new Date().toLocaleString(),
    encrypted: true,
    content: content || null
  };
  
  state.receivedFiles.unshift(receivedRecord);
  localStorage.setItem('halfByteReceived', JSON.stringify(state.receivedFiles));
  
  updateReceivedBadge();
  closeReceiveModal();
  showToast('File Received', 'File added to your received files');
  
  if (document.getElementById('page-received').classList.contains('active')) {
    renderReceivedFiles();
  }
}

// Render Functions
function renderReceivedFiles() {
  const container = document.getElementById('receivedList');
  
  if (state.receivedFiles.length === 0) {
    container.innerHTML = `
      <div class="glass-card" style="text-align: center; padding: 60px; color: var(--text-muted);">
        <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
        <p>No received files</p>
        <p style="font-size: 14px; margin-top: 8px;">Click "Receive File" to add shared files</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = state.receivedFiles.map(item => `
    <div class="glass-card history-item" onclick="previewReceivedFile('${item.id}')">
      <div class="history-icon" style="background: var(--gradient-2);">üì•</div>
      <div class="history-info">
        <div style="font-weight: 500;">${item.fileName}</div>
        <div class="history-meta">
          <span>From: ${item.sender}</span>
          <span>üìÖ ${item.receivedAt}</span>
          <span class="badge" style="margin: 0;">${item.permission === 'view' ? 'üëÅ View Only' : '‚¨á Can Download'}</span>
        </div>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="btn btn-secondary" onclick="event.stopPropagation(); previewReceivedFile('${item.id}')" style="padding: 8px 12px;" title="Preview">
          üëÅ
        </button>
        ${item.permission === 'download' ? `
        <button class="btn" onclick="event.stopPropagation(); downloadReceivedFile('${item.id}')" style="padding: 8px 12px;" title="Download">
          ‚¨á
        </button>
        ` : ''}
      </div>
    </div>
  `).join('');
}

function renderSharedFiles() {
  const container = document.getElementById('sharedList');
  
  if (state.sharedFiles.length === 0) {
    container.innerHTML = `
      <div class="glass-card" style="text-align: center; padding: 60px; color: var(--text-muted);">
        <div style="font-size: 48px; margin-bottom: 16px;">üì§</div>
        <p>No shared files</p>
        <p style="font-size: 14px; margin-top: 8px;">Share files from the encryption page</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = state.sharedFiles.map(item => `
    <div class="glass-card history-item">
      <div class="history-icon" style="background: var(--gradient-3);">üì§</div>
      <div class="history-info">
        <div style="font-weight: 500;">${item.fileName}</div>
        <div class="history-meta">
          <span>To: ${item.recipient}</span>
          <span>üìÖ ${item.timestamp}</span>
          <span style="font-family: 'JetBrains Mono', monospace; background: rgba(124,140,255,0.1); padding: 2px 8px; border-radius: 4px;">Code: ${item.shareCode}</span>
        </div>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="btn btn-secondary" onclick="copyShareCode('${item.shareCode}')" style="padding: 8px 12px;" title="Copy Code">
          üìã
        </button>
        <button class="btn btn-danger" onclick="revokeShare('${item.id}')" style="padding: 8px 12px;" title="Revoke Access">
          üö´
        </button>
      </div>
    </div>
  `).join('');
}

function updateReceivedBadge() {
  const badge = document.getElementById('receivedBadge');
  const count = state.receivedFiles.filter(r => !r.viewed).length;
  if (count > 0) {
    badge.textContent = count;
    badge.style.display = 'flex';
  } else {
    badge.style.display = 'none';
  }
}

// File Actions
function previewReceivedFile(id) {
  const file = state.receivedFiles.find(f => f.id === id);
  if (!file) return;
  
  document.getElementById('previewTitle').textContent = file.fileName;
  document.getElementById('previewContent').textContent = file.content || 
    `[Encrypted Content]\n\nFile: ${file.fileName}\nSender: ${file.sender}\nReceived: ${file.receivedAt}\n\nThis file is encrypted. Click "Decrypt & Download" to access the contents.`;
  
  document.getElementById('previewDecryptBtn').style.display = file.permission === 'download' ? 'flex' : 'none';
  document.getElementById('previewModal').classList.add('active');
  
  // Mark as viewed
  file.viewed = true;
  localStorage.setItem('halfByteReceived', JSON.stringify(state.receivedFiles));
  updateReceivedBadge();
}

function closePreviewModal() {
  document.getElementById('previewModal').classList.remove('active');
}

function decryptPreview() {
  showToast('Decrypting', 'Preparing secure decryption...');
  // Implementation would handle actual decryption with private key
  setTimeout(() => {
    showToast('Ready', 'File decrypted and ready for download');
  }, 1500);
}

function downloadReceivedFile(id) {
  const file = state.receivedFiles.find(f => f.id === id);
  if (!file) return;
  
  if (file.permission !== 'download') {
    showToast('Access Denied', 'You only have view permission for this file', 'error');
    return;
  }
  
  // Simulate download
  showToast('Downloading', `Preparing ${file.fileName} for download...`);
}

function copyShareCode(code) {
  navigator.clipboard.writeText(code);
  showToast('Copied', 'Share code copied to clipboard');
}

function revokeShare(id) {
  if (!confirm('Revoke access to this file? The recipient will no longer be able to access it.')) return;
  
  state.sharedFiles = state.sharedFiles.filter(s => s.id !== id);
  localStorage.setItem('halfByteShared', JSON.stringify(state.sharedFiles));
  renderSharedFiles();
  showToast('Access Revoked', 'File share has been revoked');
}


</script>
<!-- Share File Modal -->
<div class="modal-overlay" id="shareModal" onclick="closeModal(event)">
  <div class="modal-content" style="max-width: 500px;">
    <h3 style="margin-bottom: 24px;">Share Encrypted File</h3>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Recipient Researcher ID</label>
      <input type="text" class="input-field" id="shareRecipient" placeholder="Enter researcher ID">
    </div>

    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Encrypted File</label>
      <select class="input-field" id="shareFileSelect">
        <option value="">Select a file from history...</option>
      </select>
    </div>

    <div style="margin-bottom: 24px;">
      <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Access Permissions</label>
      <div style="display: flex; gap: 12px;">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="radio" name="sharePerm" value="view" checked> View Only
        </label>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="radio" name="sharePerm" value="download"> Can Download
        </label>
      </div>
    </div>

    <div style="background: rgba(124, 140, 255, 0.1); border-radius: 12px; padding: 16px; margin-bottom: 24px; font-size: 13px; color: var(--text-secondary);">
      <strong style="color: var(--accent-primary);">üîê Security Note:</strong> The recipient will need their private key to decrypt this file. The shared file remains encrypted end-to-end.
    </div>

    <div style="display: flex; gap: 12px;">
      <button class="btn btn-secondary" style="flex: 1;" onclick="closeShareModal()">Cancel</button>
      <button class="btn" style="flex: 1;" onclick="shareFile()">Share File</button>
    </div>
  </div>
</div>

<!-- Receive File Modal -->
<div class="modal-overlay" id="receiveModal" onclick="closeModal(event)">
  <div class="modal-content" style="max-width: 500px;">
    <h3 style="margin-bottom: 24px;">Receive Shared File</h3>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Share Code / File ID</label>
      <input type="text" class="input-field" id="receiveCode" placeholder="Enter share code or paste encrypted data">
    </div>

    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Or Paste Encrypted Content</label>
      <textarea class="input-field" id="receiveContent" rows="4" placeholder="Paste base64 encrypted content here..." style="resize: vertical; font-family: 'JetBrains Mono', monospace; font-size: 12px;"></textarea>
    </div>

    <div style="display: flex; gap: 12px;">
      <button class="btn btn-secondary" style="flex: 1;" onclick="closeReceiveModal()">Cancel</button>
      <button class="btn" style="flex: 1;" onclick="receiveFile()">Receive & Decrypt</button>
    </div>
  </div>
</div>

<!-- File Preview Modal -->
<div class="modal-overlay" id="previewModal" onclick="closeModal(event)">
  <div class="modal-content" style="max-width: 700px; max-height: 80vh; display: flex; flex-direction: column;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h3 id="previewTitle">File Preview</h3>
      <span class="badge" id="previewBadge">Encrypted</span>
    </div>
    
    <div style="flex: 1; overflow: auto; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px; font-family: 'JetBrains Mono', monospace; font-size: 12px;" id="previewContent">
      <!-- Content loaded here -->
    </div>

    <div style="display: flex; gap: 12px; justify-content: flex-end;">
      <button class="btn btn-secondary" onclick="closePreviewModal()">Close</button>
      <button class="btn" id="previewDecryptBtn" onclick="decryptPreview()">
        <span>üîì</span>
        <span>Decrypt & Download</span>
      </button>
    </div>
  </div>
</div>
</body>
</html>